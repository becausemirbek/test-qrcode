<html>
  <head>
    <title>Html-Qrcode Demo</title>
    <body>
      <div id="qr-reader" style="width: 500px"></div>
      <div id="qr-reader-results"></div>
      <button id="submitBtn" disabled>Отправить</button>
    </body>
    <script src="./html5-qrcode.min.js"></script>
    <script>
      function docReady(fn) {
        // see if DOM is already available
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          // call on next available tick
          setTimeout(fn, 1);
        } else {
          document.addEventListener("DOMContentLoaded", fn);
        }
      }

      docReady(function () {
        var resultContainer = document.getElementById("qr-reader-results");
        var submitBtn = document.getElementById("submitBtn");
        var lastResult,
          countResults = 0;
        function onScanSuccess(qrCodeMessage) {
          if (qrCodeMessage !== lastResult) {
            ++countResults;
            lastResult = qrCodeMessage;
            resultContainer.innerHTML += `<div>[${countResults}] - ${qrCodeMessage}</div>`;
          }
          submitBtn.removeAttribute("disabled");
          localStorage.setItem("makers.qrcode", lastResult);
          localStorage.setItem("makers.user");
        }
        function onSubmit() {
          fetch(
            "https://docs.google.com/forms/u/0/d/e/1FAIpQLScSFTODP2wz7lP-s-DJraOJO6NngkX8eL5-RH4DoYi4QTnMOw/formResponse",
            {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: {
                "entry.843509151": localStorage.getItem("makers.qrcode"),
                "entry.1694132655": localStorage.getItem("makers.user"),
              },
            }
          )
            .then(() => {
              alert("Success!");
            })
            .catch((error) => {
              console.log({ error });
              alert("Error: " + error.message);
            });
        }

        var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", {
          fps: 10,
          qrbox: 250,
        });
        html5QrcodeScanner.render(onScanSuccess);
        submitBtn.onclick = onSubmit;
      });
    </script>
  </head>
</html>
